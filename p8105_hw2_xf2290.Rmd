---
title: "p8105_hw2_xf2290"
author: "Xiwei Fu"
date: "2025-10-01"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


Probelm 1
```{r}
library(tidyverse)
#relative paths
pols <- read_csv("pols-month.csv")
snp <- read_csv("snp.csv")
unemp <- read_csv("unemployment.csv")
```
Clean pols
```{r}
pols_clean <- pols %>% #new set
  separate(mon, into = c("year", "month", "day"), sep = "-", convert = TRUE) %>%
  mutate(
    month = month.name[month],  # replace it with month name
    president = if_else(prez_gop == 1, "gop", "dem")
  ) %>%
  select(-prez_gop, -prez_dem, -day) %>%
  arrange(year, month)
```
Clean snp
```{R}
snp_clean <- snp %>%
  separate(date, into = c("month", "day", "year"), sep = "/", convert = TRUE) %>%
  mutate(
    # Convert 2-digit year into 4-digit
    year = if_else(year < 50, year + 2000, year + 1900),
    month = month.name[month] 
  ) %>%
  select(year, month, close) %>%
  arrange(year, month)
```
Clean unemp
```{R}
unemp_clean <- unemp %>%
  pivot_longer(cols = Jan:Dec, names_to = "month", values_to = "unemployment") %>%
  mutate(
    month = case_when(
      month == "Jan" ~ "January",
      month == "Feb" ~ "February",
      month == "Mar" ~ "March",
      month == "Apr" ~ "April",
      month == "May" ~ "May",
      month == "Jun" ~ "June",
      month == "Jul" ~ "July",
      month == "Aug" ~ "August",
      month == "Sep" ~ "September",
      month == "Oct" ~ "October",
      month == "Nov" ~ "November",
      month == "Dec" ~ "December"
    )
  ) %>%
  rename(year = Year) %>%
  arrange(year, month)
```
Mere datasets
```{R}
merged_data1 <- left_join(pols_clean, snp_clean, by = c("year", "month"))

final_data <- left_join(merged_data1, unemp_clean, by = c("year", "month"))
```

The pols-month dataset contained monthly counts of political leaders, including indicators of whether the president was Republican or Democrat, as well as the number of governors, senators, and representatives by party. The snp dataset tracked the Standard & Poorâ€™s stock market index through its monthly closing values, reflecting broader economic conditions. The unemployment dataset provided monthly unemployment percentages for each year. After cleaning and merging, the resulting dataset (final_data) contains 822 observations and 11 variables, covering a wide range of years. Key variables include year, month, president (party of the sitting president), counts of Democratic and Republican officeholders (gov_gop, sen_gop, rep_gop, etc.), the S&P index closing value (close), and the monthly unemployment rate (unemployment).

Problem 2
```{R}
library(tidyverse)
library(readxl)
mr_trash <- read_excel("202409 Trash Wheel Collection Data.xlsx",
                       sheet = "Mr. Trash Wheel",
                       skip = 1) %>%   # skips metadata row
  janitor::clean_names() %>%
  filter(!is.na(dumpster)) %>%       # keep only actual dumpster rows
  mutate(
    sports_balls = as.integer(round(sports_balls, 0)),
    year = as.integer(year),
    wheel = "Mr. Trash Wheel"        # add identifier
  )
```
```{R}
prof_trash <- read_excel("202409 Trash Wheel Collection Data.xlsx",
                         sheet = "Professor Trash Wheel",
                         skip = 1) %>%
  janitor::clean_names() %>%
  filter(!is.na(dumpster)) %>%
  mutate(
    year = as.integer(year),
    wheel = "Professor Trash Wheel"
  )
```

```{R}
gwy_trash <- read_excel("202409 Trash Wheel Collection Data.xlsx",
                      sheet = "Gwynnda Trash Wheel",
                      skip = 1) %>%
  janitor::clean_names() %>%
  filter(!is.na(dumpster)) %>%
  mutate(
    year = as.integer(year),
    wheel = "Gwynnda Trash Wheel"
  )
```
```{R}
trash_wheels <- bind_rows(mr_trash, prof_trash, gwy_trash)
```

```{R}
total_prof_weight <- sum(trash_wheels$weight_tons[trash_wheels$wheel == "Professor Trash Wheel"], na.rm = TRUE)
gwynnda_cigs_june22 <- sum(trash_wheels$cigarette_butts[
  trash_wheels$wheel == "Gwynnda Trash Wheel" & 
  trash_wheels$year == 2022 & 
  lubridate::month(trash_wheels$date) == 6
], na.rm = TRUE)
```
The combined Trash Wheel dataset includes information from Mr. Trash Wheel, Professor Trash Wheel, and Gwynnda, resulting in 1,033 observations and 17 variables. Each row represents a dumpster load of trash, with key variables such as dumpster (load identifier), date, year, weight_tons (the total weight of trash collected), and item-specific counts including plastic_bottles, cigarette_butts, and sports_balls. From the available data, Professor Trash Wheel collected a total of 246.74 tons of trash, while Gwynnda collected 18120 cigarette butts in June 2022.

Problem 3

```{R}
library(readr)
library(dplyr)
library(tidyr)
library(stringr)
library(lubridate)
library(janitor)

zori <- read_csv("Zip_zori_uc_sfrcondomfr_sm_month_NYC.csv")
zori_long <- zori %>%
  pivot_longer(
    cols = 10:ncol(.),          
    names_to = "date",
    values_to = "zori"
  ) %>%
  mutate(
    zori = as.numeric(zori),
    zip = str_pad(as.character(RegionName), 5, pad = "0")
  ) %>%
  select(zip, zori, everything())

zipcodes <- read_csv("Zip Codes.csv", show_col_types = FALSE) %>%
  clean_names() %>%
  rename(zip = zip_code) %>%
  mutate(zip = str_pad(as.character(zip), 5, pad = "0"))

final_dataset <- zori_long %>%
  left_join(zipcodes, by = "zip")

final_dataset <- final_dataset %>%
  select(-RegionType, -RegionName)

glimpse(final_dataset)
head(final_dataset)
```
The final tidy dataset contains 17516 observations and 16 variables.

```{R}
n_unique_zip <- final_dataset %>% summarize(unique_zip = n_distinct(zip))
n_unique_neighborhood <- final_dataset %>% summarize(unique_neighborhood = n_distinct(neighborhood))

n_unique_zip
n_unique_neighborhood
```
It includes 149 unique ZIP codes and 43 unique neighborhoods.

```{R}

zori_zips <- zori %>%
  transmute(zip = str_pad(as.character(RegionName), 5, pad = "0")) %>%
  distinct() %>%
  pull(zip)

zipfile_zips <- zipcodes %>%
  transmute(zip = str_pad(as.character(zip), 5, pad = "0")) %>%
  distinct() %>%
  pull(zip)

zips_only_in_zipfile <- setdiff(zipfile_zips, zori_zips)

print(head(zips_only_in_zipfile))
```
171 ZIP codes appear in the ZIP code dataset but not in the Zillow dataset.
Examples include "10464" "10474" "10475" "10499" "10550" "10704" etc. I have all of them store in "zips_only_in_zipfile"
These are often special-purpose ZIP codes such as commercial-only areas, government buildings, PO box areas, or low-population zones without active residential rental markets.

```{r}
library(dplyr)
library(lubridate)

top10_drop <- final_dataset %>%
  filter(month(date) == 1, year(date) %in% c(2020, 2021)) %>%
  mutate(year = year(date)) %>%
  group_by(zip, year, county, neighborhood) %>%
  summarize(zori_mean = mean(zori, na.rm = TRUE), .groups = "drop") %>%
  tidyr::pivot_wider(names_from = year, values_from = zori_mean, names_prefix = "y") %>%
  filter(!is.na(y2020), !is.na(y2021)) %>%
  mutate(
    drop_abs = y2021 - y2020,
    pct_drop = (y2021 - y2020) / y2020 * 100
  ) %>%
  arrange(drop_abs) %>%   
  slice_head(n = 10) %>%
  select(zip, county, neighborhood, zori_2020 = y2020, zori_2021 = y2021, drop_abs, pct_drop) %>%
  mutate(
    zori_2020 = round(zori_2020, 2),
    zori_2021 = round(zori_2021, 2),
    drop_abs = round(drop_abs, 2),
    pct_drop = round(pct_drop, 1)
  )

top10_drop
```


From January 2020 to January 2021, rental prices fell sharply in many ZIP codes.
The 10 ZIP codes with the largest drops were:10007, 10069, 10009, 10016, 10001, 10002, 10004, 10038, 10012, 10010, they are listed in order from the largest to the smallest decline.
The largest declines occurred in high-rent Manhattan ZIP codes such as Lower Manhattan, Lower East Side, and Chelsea. These areas rely heavily on office workers, tourism, and students, all of which were disrupted during the COVID-19 pandemic, leading to sharp drops in rental demand and prices.

